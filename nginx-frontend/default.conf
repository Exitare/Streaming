server {
    listen 80;
    server_name localhost;

    location /api/ {
        proxy_pass http://quart-backend:8000/;
    }

    location /hls/ {
        root /tmp;
        types {
            application/vnd.apple.mpegurl m3u8;
            video/mp2t ts;
        }
        add_header Cache-Control no-cache always;
        add_header Access-Control-Allow-Origin "*" always;
        add_header Access-Control-Allow-Methods "GET, OPTIONS" always;
        add_header Access-Control-Allow-Headers "Range, Origin, X-Requested-With, Content-Type, Accept" always;

        if ($request_method = 'OPTIONS') {
            add_header Content-Length 0;
            add_header Content-Type text/plain;
            return 204;
        }
    }
}